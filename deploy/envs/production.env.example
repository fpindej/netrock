# ══════════════════════════════════════════════════════════════════════════════
#  Environment Variables — Production
# ══════════════════════════════════════════════════════════════════════════════
#
#  Setup:
#    cp deploy/envs/production.env.example deploy/envs/production.env
#    # Fill in ALL required values below
#    ./deploy/up.sh production up -d
#
#  Every required variable is marked with "REQUIRED". All others have sensible
#  defaults or are optional. Never commit the filled-in production.env file.
#
# ══════════════════════════════════════════════════════════════════════════════

# ── Docker Images (REQUIRED) ────────────────────────────────────────────────
# Full image references including registry and tag.
# Built and pushed by: ./deploy/build.sh
API_IMAGE=registry.example.com/myapp-api:0.1.0
FRONTEND_IMAGE=registry.example.com/myapp-frontend:0.1.0

# ── Database (REQUIRED) ─────────────────────────────────────────────────────
POSTGRES_USER=<db-username>
POSTGRES_PASSWORD=<strong-random-password>
# POSTGRES_DB=myapp

# ── Caching / Redis (RECOMMENDED) ──────────────────────────────────────────
# Master switch — set to false to run without any cache provider.
# Caching__Enabled=true

# Enable Redis as the distributed cache backend (recommended for production).
# When false or omitted, falls back to in-memory cache.
Caching__Redis__Enabled=true
REDIS_PASSWORD=<strong-random-password>

# Circuit breaker — short-circuits cache operations during sustained outages.
# Defaults (5 failures / 30s break / 30s window) are suitable for most deployments.
# Caching__CircuitBreaker__FailureThreshold=5
# Caching__CircuitBreaker__BreakDuration=00:00:30
# Caching__CircuitBreaker__SamplingDuration=00:00:30

# ── File Storage (MinIO / S3) ──────────────────────────────────────────────────
# MinIO root credentials (used for the storage container and as S3 access keys).
MINIO_ROOT_USER=<minio-access-key>
MINIO_ROOT_PASSWORD=<minio-secret-key>
FileStorage__BucketName=<your-bucket-name>
# For external S3-compatible storage, override these in docker-compose:
# FileStorage__Endpoint=https://s3.amazonaws.com
# FileStorage__Region=us-east-1
# FileStorage__UseSSL=true

# ── Authentication (REQUIRED) ───────────────────────────────────────────────
# Minimum 32 characters. Generate with: openssl rand -base64 64 | tr -d '\n/+=' | cut -c1-64
JWT_SECRET_KEY=<strong-random-secret-at-least-32-chars>

# Token lifetimes (defaults are conservative for production):
# Authentication__Jwt__AccessTokenLifetime=00:15:00
# Authentication__Jwt__RefreshToken__PersistentLifetime=30.00:00:00
# Authentication__Jwt__RefreshToken__SessionLifetime=1.00:00:00
# Authentication__Jwt__Issuer=MyProjectIssuer
# Authentication__Jwt__Audience=MyProjectAudience

# ── CORS (REQUIRED for web access) ──────────────────────────────────────────
# Lock down to your exact domain(s). Never use AllowAllOrigins in production.
Cors__AllowAllOrigins=false
Cors__AllowedOrigins__0=https://your-domain.com

# ── Hosting ──────────────────────────────────────────────────────────────────
# Force HTTPS scheme in generated URLs (e.g. email links). Default: true.
# Hosting__ForceHttps=true

# Trusted reverse proxy networks for X-Forwarded-For header processing.
# Add your load balancer / reverse proxy IP or CIDR:
# Hosting__ReverseProxy__TrustedNetworks__0=10.0.0.0/16
# Hosting__ReverseProxy__TrustedProxies__0=10.0.0.5

# ── Email (REQUIRED for password reset / email verification) ────────────────
Email__Smtp__Host=smtp.example.com
Email__Smtp__Port=587
Email__Smtp__Username=<smtp-username>
Email__Smtp__Password=<smtp-password>
Email__Smtp__UseSsl=true
Email__FromAddress=noreply@your-domain.com
Email__FromName=MyApp
# Base URL for links in emails (password reset, email verification).
# Must match the public frontend URL.
Email__FrontendBaseUrl=https://your-domain.com

# ── CAPTCHA (Cloudflare Turnstile) ──────────────────────────────────────────
# Site key (public, passed to frontend at runtime):
TURNSTILE_SITE_KEY=<your-turnstile-site-key>
# Secret key (server-side validation, consumed by the API):
Captcha__SecretKey=<your-turnstile-secret-key>

# ── Frontend ─────────────────────────────────────────────────────────────────
# URL the frontend container uses to reach the backend API (internal network).
# Default http://api:8080 works when both containers are on the same compose network.
# API_URL=http://api:8080

# Trusted reverse proxy hops for SvelteKit's getClientAddress().
# Set to 1 if behind nginx/Caddy, 2 if behind a cloud LB + nginx, etc.
XFF_DEPTH=1

# Additional origins for SvelteKit API proxy CSRF check (comma-separated).
# Usually not needed in production if the app is served from a single domain.
# ALLOWED_ORIGINS=

# ── Ports ────────────────────────────────────────────────────────────────────
# Host ports for the API and frontend. Typically fronted by a reverse proxy
# that terminates TLS (e.g. nginx, Caddy, Traefik).
# API_PORT=8080
# FRONTEND_PORT=3000

# ── SvelteKit Origin (REQUIRED) ──────────────────────────────────────────────
# Required when behind a TLS-terminating reverse proxy so SvelteKit generates
# correct URLs and validates CSRF origins. Set to your public domain.
ORIGIN=https://your-domain.com

# ── Job Scheduling (Hangfire) ───────────────────────────────────────────────
# Disable background job processing on this node (e.g. if running dedicated workers).
# JobScheduling__Enabled=true
# JobScheduling__WorkerCount=4

# ── Rate Limiting ────────────────────────────────────────────────────────────
# RateLimiting__Global__PermitLimit=60
# RateLimiting__Global__Window=00:01:00

# ── Logging ──────────────────────────────────────────────────────────────────
# Serilog__MinimumLevel__Default=Warning

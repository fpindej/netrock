# ══════════════════════════════════════════════════════════════════════════════
#  Environment Variables — Local Development
# ══════════════════════════════════════════════════════════════════════════════
#
#  This file is committed to git and serves as the single source of truth
#  for local Docker development. The init script fills in placeholders
#  ({INIT_*}) during project setup — no manual copy step needed.
#
#  To tune a setting, edit this file and restart Docker:
#    ./deploy/up.sh local up -d --build
#
#  How Docker Compose reads these values:
#    - ${VAR} references in compose files are resolved from this file
#      (via --env-file flag in up.sh)
#    - The API container also loads this file via env_file directive, so any
#      ASP.NET config key (e.g. Authentication__Jwt__AccessTokenLifetime=01:40:00)
#      set here overrides appsettings without touching JSON files.
#
#  Precedence (highest -> lowest):
#    1. docker compose run --env                          (CLI override, rare)
#    2. compose overlay `environment` block                (interpolated from env file)
#    3. env file via `env_file` directive                  (pass-through to container)
#    4. appsettings.{Environment}.json                     (ASP.NET config layering)
#    5. appsettings.json                                   (base defaults)
#
#  PRODUCTION: Do not use these values. See deploy/envs/production.env.example.
# ══════════════════════════════════════════════════════════════════════════════

# ── Database (PostgreSQL) ────────────────────────────────────────────────────
POSTGRES_USER=admin
POSTGRES_PASSWORD=pwd
POSTGRES_DB={INIT_PROJECT_SLUG}

# Full connection string override (not needed locally — composed automatically):
# ConnectionStrings__Database=Host=localhost;Port=5432;Database=myapp;Username=admin;Password=pwd

# ── Caching / Redis ────────────────────────────────────────────────────────
REDIS_PASSWORD=redis-dev-password

# Master switch — set to false to disable caching entirely (no Redis or
# in-memory cache required). When disabled, a no-op cache is used.
# Caching__Enabled=true

# Redis connection string override (not needed locally):
# Caching__Redis__ConnectionString=redis:6379
# Caching__Redis__UseSsl=false

# Circuit breaker — short-circuits cache operations during sustained outages.
# Defaults work without configuration. Uncomment to tune:
# Caching__CircuitBreaker__FailureThreshold=5
# Caching__CircuitBreaker__BreakDuration=00:00:30
# Caching__CircuitBreaker__SamplingDuration=00:00:30

# ── File Storage (MinIO / S3) ──────────────────────────────────────────────────
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
FileStorage__BucketName={INIT_PROJECT_SLUG}-files
# FileStorage__Endpoint, FileStorage__AccessKey, FileStorage__SecretKey, and
# FileStorage__UseSSL are composed automatically in docker-compose.yml.

# ── Authentication (JWT) ─────────────────────────────────────────────────────
# The init script replaces {INIT_JWT_SECRET} with a random 64-character secret.
# For local development, any string >= 32 characters works fine.
JWT_SECRET_KEY={INIT_JWT_SECRET}

# Token lifetimes (generous for local development):
Authentication__Jwt__AccessTokenLifetime=01:40:00
Authentication__Jwt__RefreshToken__PersistentLifetime=7.00:00:00
Authentication__Jwt__RefreshToken__SessionLifetime=1.00:00:00
Authentication__Jwt__Issuer=MyProjectIssuer
Authentication__Jwt__Audience=MyProjectAudience

# Email token settings (opaque tokens for password-reset / email-verification links):
Authentication__EmailToken__TokenLengthInBytes=32
Authentication__EmailToken__Lifetime=1.00:00:00

# ── CORS ─────────────────────────────────────────────────────────────────────
# Development allows all origins (set in appsettings.Development.json).
# Cors__AllowAllOrigins=false
# Cors__AllowedOrigins__0=https://your-domain.com

# ── Hosting ───────────────────────────────────────────────────────────────────
# Force HTTPS scheme when behind a TLS-terminating proxy (default: true).
# Disabled for local development in appsettings.Development.json.
# Hosting__ForceHttps=false

# Trusted reverse proxy networks/IPs for X-Forwarded-For (rate limiting, logging).
# Docker bridge (172.16.0.0/12) is pre-configured in docker-compose.
# Hosting__ReverseProxy__TrustedNetworks__0=10.0.0.0/16
# Hosting__ReverseProxy__TrustedProxies__0=10.0.0.5

# ── Rate Limiting ────────────────────────────────────────────────────────────
# appsettings.Development.json uses very permissive defaults (300 req / 10s).
# Uncomment to override with production-like limits:
# RateLimiting__Global__PermitLimit=120
# RateLimiting__Global__Window=00:01:00

# ── Job Scheduling (Hangfire) ───────────────────────────────────────────────
# Disable to skip background job registration (useful during debugging):
# JobScheduling__Enabled=true
# JobScheduling__WorkerCount=4

# ── Logging (Serilog -> Seq) ──────────────────────────────────────────────────
Serilog__MinimumLevel__Default=Information

# ── Docker Compose Ports ─────────────────────────────────────────────────────
# Override to resolve port conflicts when running multiple projects.
# Defaults are baked into docker-compose.local.yml during init.
# FRONTEND_PORT={INIT_FRONTEND_PORT}
# API_PORT={INIT_API_PORT}
# DB_PORT={INIT_DB_PORT}
# REDIS_PORT={INIT_REDIS_PORT}
# STORAGE_PORT={INIT_STORAGE_PORT}
# STORAGE_CONSOLE_PORT={INIT_STORAGE_CONSOLE_PORT}
# SEQ_PORT={INIT_SEQ_PORT}

# ── Email ─────────────────────────────────────────────────────────────────────
# The NoOp email service logs emails to Serilog/Seq instead of sending them.
# To use a real SMTP server, uncomment and fill in the values below:
# Email__Smtp__Host=smtp.example.com
# Email__Smtp__Port=587
# Email__Smtp__Username=your-smtp-username
# Email__Smtp__Password=your-smtp-password
# Email__Smtp__UseSsl=true
# Email__FromAddress=noreply@example.com
# Email__FromName=MyProject
# Email__FrontendBaseUrl=http://localhost:5173

# ── CAPTCHA (Cloudflare Turnstile) ────────────────────────────────────────────
# Turnstile site key — passed to the frontend at runtime.
# The testing key below always passes validation (Cloudflare's official test key).
# Get a real key at: https://dash.cloudflare.com/?to=/:account/turnstile
TURNSTILE_SITE_KEY=1x00000000000000000000AA

# ── Frontend ─────────────────────────────────────────────────────────────────
# URL the frontend container uses to reach the backend API.
# To debug the backend in Rider/VS while the frontend runs in Docker,
# uncomment and point to the host machine:
# API_URL=http://host.docker.internal:5142

# Number of trusted reverse proxy hops in front of the SvelteKit server.
# Required for getClientAddress() to return the real client IP (for rate limiting).
# Set to 1 if behind nginx/Caddy, 2 if behind a cloud LB + nginx, etc.
# Not needed when no reverse proxy sits in front of SvelteKit (e.g., local Docker).
# XFF_DEPTH=1

# Additional origins allowed through the SvelteKit API proxy CSRF check.
# Comma-separated. Use when accessing the frontend through a reverse proxy,
# tunnel (ngrok, Tailscale), or any URL that differs from the app's own origin.
# ALLOWED_ORIGINS=https://abc123.ngrok-free.app
